<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>InsureDesk ‚Äî Reset Password</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
:root{--bg:#0a0e1a;--surface:#111827;--surface2:#1a2235;--surface3:#222d42;--border:rgba(255,255,255,0.07);--border2:rgba(255,255,255,0.13);--accent:#00d4ff;--accent2:#7c3aed;--accent3:#10b981;--accent5:#ef4444;--text:#f0f4ff;--muted:#6b7a99;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden;}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 80% 60% at 15% 10%,rgba(0,212,255,0.07) 0%,transparent 60%),radial-gradient(ellipse 60% 50% at 85% 85%,rgba(124,58,237,0.07) 0%,transparent 60%);pointer-events:none;}
.grid-bg{position:fixed;inset:0;background-image:linear-gradient(rgba(0,212,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,0.03) 1px,transparent 1px);background-size:60px 60px;animation:gridMove 20s linear infinite;}
@keyframes gridMove{0%{transform:translateY(0)}100%{transform:translateY(60px)}}
.orb{position:fixed;border-radius:50%;filter:blur(80px);animation:float 8s ease-in-out infinite;}
.orb1{width:400px;height:400px;background:rgba(0,212,255,0.05);top:-100px;left:-100px;}
.orb2{width:300px;height:300px;background:rgba(124,58,237,0.06);bottom:-50px;right:-50px;animation-delay:3s;}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-30px)}}
.card{position:relative;z-index:10;width:100%;max-width:420px;padding:2.5rem;background:rgba(17,24,39,0.8);border:1px solid var(--border2);border-radius:24px;backdrop-filter:blur(32px);box-shadow:0 32px 80px rgba(0,0,0,0.5);animation:cardIn 0.6s cubic-bezier(.34,1.56,.64,1);}
@keyframes cardIn{from{opacity:0;transform:translateY(30px) scale(0.95)}to{opacity:1;transform:translateY(0) scale(1)}}
.logo-wrap{text-align:center;margin-bottom:2rem;}
.logo{font-family:'Syne',sans-serif;font-weight:800;font-size:1.8rem;letter-spacing:-1px;}
.logo span{color:var(--accent);}
.logo-icon{width:52px;height:52px;background:linear-gradient(135deg,rgba(0,212,255,0.15),rgba(124,58,237,0.15));border:1px solid rgba(0,212,255,0.2);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:1.4rem;margin:0 auto 1rem;box-shadow:0 0 30px rgba(0,212,255,0.1);}
.page-title{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700;margin-bottom:0.5rem;}
.page-sub{font-size:0.82rem;color:var(--muted);margin-bottom:1.5rem;}
.field{margin-bottom:1.2rem;}
.field label{display:block;font-size:0.75rem;color:var(--muted);font-weight:500;letter-spacing:0.5px;text-transform:uppercase;margin-bottom:8px;}
.field input{width:100%;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:0.92rem;transition:all 0.2s;outline:none;}
.field input:focus{border-color:rgba(0,212,255,0.4);background:var(--surface3);box-shadow:0 0 0 3px rgba(0,212,255,0.08);}
.field input::placeholder{color:var(--muted);}
.pw-wrap{position:relative;}
.pw-wrap input{padding-right:44px;}
.pw-toggle{position:absolute;right:14px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--muted);cursor:pointer;font-size:1rem;padding:4px;}
.submit-btn{width:100%;padding:13px;background:linear-gradient(135deg,var(--accent),#0099cc);border:none;border-radius:12px;color:#000;font-family:'Syne',sans-serif;font-size:0.95rem;font-weight:700;cursor:pointer;transition:all 0.25s;margin-top:0.5rem;}
.submit-btn:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,212,255,0.35);}
.submit-btn:disabled{opacity:0.6;cursor:not-allowed;transform:none;}
.msg{padding:10px 14px;border-radius:10px;font-size:0.82rem;margin-bottom:1rem;display:none;}
.msg.error{background:rgba(239,68,68,0.12);border:1px solid rgba(239,68,68,0.3);color:#fca5a5;display:flex;gap:8px;align-items:center;}
.msg.success{background:rgba(16,185,129,0.12);border:1px solid rgba(16,185,129,0.3);color:#6ee7b7;display:flex;gap:8px;align-items:center;}
.strength{height:4px;border-radius:2px;margin-top:6px;background:var(--border);overflow:hidden;}
.strength-bar{height:100%;border-radius:2px;transition:all 0.3s;width:0%;}
.strength-text{font-size:0.7rem;color:var(--muted);margin-top:4px;}
.back-link{text-align:center;margin-top:1.2rem;font-size:0.8rem;color:var(--muted);}
.back-link a{color:var(--accent);text-decoration:none;}
.spinner{width:18px;height:18px;border:2px solid rgba(0,0,0,0.3);border-top-color:#000;border-radius:50%;animation:spin 0.7s linear infinite;display:inline-block;margin-right:8px;vertical-align:middle;}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<div class="grid-bg"></div>
<div class="orb orb1"></div>
<div class="orb orb2"></div>

<div class="card">
  <div class="logo-wrap">
    <div class="logo-icon">üîë</div>
    <div class="logo">Insure<span>Desk</span></div>
  </div>

  <div class="page-title">Set New Password</div>
  <div class="page-sub">Enter your new password below.</div>

  <div id="errorMsg" class="msg error">‚ö†Ô∏è <span id="errorText"></span></div>
  <div id="successMsg" class="msg success">‚úÖ <span id="successText"></span></div>

  <div id="resetForm">
    <div class="field">
      <label>New Password</label>
      <div class="pw-wrap">
        <input type="password" id="password" placeholder="Min. 6 characters" oninput="checkStrength(this.value)"/>
        <button class="pw-toggle" onclick="togglePw('password','t1')" id="t1">üëÅ</button>
      </div>
      <div class="strength"><div class="strength-bar" id="strengthBar"></div></div>
      <div class="strength-text" id="strengthText"></div>
    </div>

    <div class="field">
      <label>Confirm Password</label>
      <div class="pw-wrap">
        <input type="password" id="confirm" placeholder="Re-enter password"/>
        <button class="pw-toggle" onclick="togglePw('confirm','t2')" id="t2">üëÅ</button>
      </div>
    </div>

    <button class="submit-btn" id="resetBtn" onclick="resetPassword()">Set New Password</button>
  </div>

  <div class="back-link"><a href="login.html">‚Üê Back to Sign In</a></div>
</div>

<script>
const API = 'https://insuredesk-production.up.railway.app';
const token = new URLSearchParams(window.location.search).get('token');

if (!token) {
  document.getElementById('errorText').textContent = 'Invalid reset link. Please request a new one.';
  document.getElementById('errorMsg').style.display = 'flex';
  document.getElementById('resetForm').style.display = 'none';
}

function togglePw(id, btnId) {
  const input = document.getElementById(id);
  const btn = document.getElementById(btnId);
  input.type = input.type === 'password' ? 'text' : 'password';
  btn.textContent = input.type === 'password' ? 'üëÅ' : 'üôà';
}

function checkStrength(pw) {
  const bar = document.getElementById('strengthBar');
  const text = document.getElementById('strengthText');
  let score = 0;
  if (pw.length >= 6) score++;
  if (pw.length >= 10) score++;
  if (/[A-Z]/.test(pw)) score++;
  if (/[0-9]/.test(pw)) score++;
  if (/[^A-Za-z0-9]/.test(pw)) score++;
  const levels = ['','Very Weak','Weak','Fair','Strong','Very Strong'];
  const colors = ['','#ef4444','#f59e0b','#f59e0b','#10b981','#00d4ff'];
  const widths = ['0%','20%','40%','60%','80%','100%'];
  bar.style.width = widths[score];
  bar.style.background = colors[score];
  text.textContent = score > 0 ? levels[score] : '';
  text.style.color = colors[score];
}

async function resetPassword() {
  const password = document.getElementById('password').value;
  const confirm = document.getElementById('confirm').value;
  const btn = document.getElementById('resetBtn');

  if (!password || !confirm) { showError('Please fill in both fields'); return; }
  if (password.length < 6) { showError('Password must be at least 6 characters'); return; }
  if (password !== confirm) { showError('Passwords do not match'); return; }

  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>Updating...';

  try {
    const res = await fetch(`${API}/api/auth/reset-password`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ token, password })
    });
    const data = await res.json();
    if (!res.ok) { showError(data.error); btn.disabled = false; btn.innerHTML = 'Set New Password'; return; }
    showSuccess('Password updated! Redirecting to login...');
    document.getElementById('resetForm').style.display = 'none';
    setTimeout(() => window.location.href = 'login.html', 2000);
  } catch(err) {
    showError('Connection error. Please try again.');
    btn.disabled = false;
    btn.innerHTML = 'Set New Password';
  }
}

function showError(msg) {
  document.getElementById('errorText').textContent = msg;
  document.getElementById('errorMsg').style.display = 'flex';
  document.getElementById('successMsg').style.display = 'none';
}
function showSuccess(msg) {
  document.getElementById('successText').textContent = msg;
  document.getElementById('successMsg').style.display = 'flex';
  document.getElementById('errorMsg').style.display = 'none';
}
</script>
</body>
</html>
